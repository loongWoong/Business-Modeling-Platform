# 模型详情数据源模块映射功能增强方案

## 需求分析

用户需要在模型详情的数据源模块中，为列表操作列添加映射按钮，点击后弹出窗口显示表ER图，支持通过连线方式将表字段映射到模型属性，采用类似ComfyUI的DAG交互风格。

## 现有代码分析

1. **当前架构**：

   * 数据源管理在 `DatasourceManager.jsx` 中实现

   * 已有映射功能通过 `MappingModal.jsx` 实现，但功能简单

   * 代码库已使用D3.js进行图形可视化（`BloodlineAnalyzer.jsx`和`ModelMap.jsx`）

2. **现有MappingModal**：

   * 基本的拖拽映射功能

   * 静态模拟数据源字段

   * 缺少ER图展示

   * 缺少DAG式连线交互

## 实现方案

### 1. 增强MappingModal组件

* **ER图可视化**：使用D3.js绘制数据库表结构的ER图

* **DAG连线交互**：实现类似ComfyUI的节点连线功能

* **双向映射支持**：表字段 → 模型属性，模型属性 → 表字段

### 2. 功能模块设计

#### 2.1 ER图展示区

* 显示数据源对应的表结构

* 表节点包含字段信息

* 支持表之间的关系展示

* 点击字段可选择进行映射

#### 2.2 模型属性区

* 展示当前模型的属性列表

* 支持选择属性进行映射

#### 2.3 DAG连线机制

* 支持从表字段拖拽到模型属性

* 支持从模型属性拖拽到表字段

* 实时显示连线预览

* 支持删除映射关系

### 3. 技术实现

#### 3.1 ER图生成

* 使用D3.js力导向图布局展示表和关系

* 表节点包含字段列表

* 支持表字段的选择和拖拽

#### 3.2 映射逻辑

* 维护映射状态（字段ID → 属性ID）

* 支持双向映射

* 实时保存映射关系

#### 3.3 UI交互

* 模态窗口布局优化

* ER图、属性列表、映射关系清晰展示

* 响应式设计

### 4. 代码修改计划

#### 4.1 修改 `MappingModal.jsx`

* 集成D3.js绘制ER图

* 实现字段选择和连线交互

* 增强映射状态管理

#### 4.2 保留现有功能

* 保持与原有拖拽映射兼容

* 保持现有API不变，确保向后兼容

### 5. 实现步骤

1. 重构MappingModal组件布局
2. 集成D3.js绘制ER图表结构
3. 实现字段选择功能
4. 实现DAG连线交互
5. 完善映射关系管理
6. 测试映射保存和加载

## 预期效果

* 数据源列表操作列添加映射按钮（已存在）

* 点击映射按钮弹出窗口，显示ER图

* 支持通过连线方式建立表字段与模型属性的映射

* 直观的DAG式可视化界面，类似ComfyUI交互风格

* 实时预览映射关系

* 支持映射关系的保存和修改


修改模型详情的数据源模块，列表操作列添加映射按钮，点击弹出窗口，窗口内显示表ER图，选中表字段通过连线映射到基于当前模型-属性